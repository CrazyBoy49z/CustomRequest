/*!
 * CustomRequest - Use friendly URLs everywhere
 * Version: 1.2.6
 * Build date: 2016-06-14
 */

customRequest=function(a){return a=a||{},Ext.applyIf(a,{}),customRequest.superclass.constructor.call(this,a),this},Ext.extend(customRequest,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{}}),Ext.reg("customrequest",customRequest),CustomRequest=new customRequest,CustomRequest.combo.Resource=function(a){a=a||{},this.ident=a.ident||"customrequest-mecitem"+Ext.id(),Ext.applyIf(a,{url:CustomRequest.config.connectorUrl,baseParams:{action:"mgr/resources/getlist",combo:!0},pageSize:10,fields:["id","pagetitle"],displayField:"pagetitle",valueField:"id",lazyRender:!0,editable:!0,typeAhead:!0,minChars:1,forceSelection:!0,triggerAction:"all"}),CustomRequest.combo.Resource.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.combo.Resource,MODx.combo.ComboBox),Ext.reg("customrequest-combo-resource",CustomRequest.combo.Resource),CustomRequest.grid.Configs=function(a){this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),a=a||{},Ext.applyIf(a,{id:"customrequest-grid-configs",url:CustomRequest.config.connectorUrl,baseParams:{action:"mgr/configs/getList"},fields:["id","name","menuindex","alias","alias_gen","pagetitle","resourceid","urlparams","regex"],autoHeight:!0,paging:!0,remoteSort:!1,enableDragDrop:!0,ddGroup:"customrequest-grid-dd",autoExpandColumn:"alias",columns:[{header:_("id"),dataIndex:"id",hidden:!0,width:20},{header:_("customrequest.configs_name"),dataIndex:"name",width:100},{header:_("customrequest.configs_alias"),dataIndex:"alias_gen",width:150},{header:_("customrequest.configs_resourceid"),dataIndex:"pagetitle",width:80},{renderer:{fn:this.buttonColumnRenderer,scope:this},width:20}],tbar:[{text:_("customrequest.configs_create"),cls:"primary-button",handler:this.createConfig,scope:this},"->",{xtype:"textfield",id:"customrequest-search-filter",emptyText:_("search")+"â€¦",submitValue:!1,listeners:{change:{fn:this.search,scope:this},render:{fn:function(a){new Ext.KeyMap(a.getEl(),{key:Ext.EventObject.ENTER,fn:function(){return this.fireEvent("change",this),this.blur(),!0},scope:a})},scope:this}}},{xtype:"button",id:this.ident+"-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}],listeners:{render:{fn:this.renderListener,scope:this}}}),CustomRequest.grid.Configs.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.grid.Configs,MODx.grid.Grid,{windows:{},getMenu:function(){var a=[];a.push({text:_("customrequest.configs_update"),handler:this.updateConfig}),a.push("-"),a.push({text:_("customrequest.configs_remove"),handler:this.removeConfig}),this.addContextMenuItem(a)},createConfig:function(a,b){this.createUpdateConfig(a,b,!1)},updateConfig:function(a,b){this.createUpdateConfig(a,b,!0)},createUpdateConfig:function(a,b,c){var d;if(c){if(!this.menu.record||!this.menu.record.id)return!1;d=this.menu.record}else d={};var e=MODx.load({xtype:"customrequest-window-config-create-update",isUpdate:c,title:c?_("customrequest.configs_update"):_("customrequest.configs_create"),record:d,listeners:{success:{fn:function(){this.refresh()},scope:this}}});e.fp.getForm().setValues(d),e.show(b.target)},removeConfig:function(){return this.menu.record?void MODx.msg.confirm({title:_("customrequest.configs_remove"),text:_("customrequest.configs_remove_confirm"),url:this.config.url,params:{action:"mgr/configs/remove",id:this.menu.record.id},listeners:{success:{fn:function(){this.refresh()},scope:this}}}):!1},search:function(a){var b=this.getStore();b.baseParams.query=a.getValue(),this.getBottomToolbar().changePage(1),this.refresh()},renderListener:function(a){new Ext.dd.DropTarget(a.container,{ddGroup:"customrequest-grid-dd",notifyDrop:function(b,c,d){var e=a.store,f=a.getSelectionModel(),g=f.getSelections(),h=b.getDragData(c);if(h){var i=h.rowIndex;if("undefined"!=typeof i){for(var j=e.getAt(i),k=[],l=0;l<g.length;l++)e.remove(e.getById(g[l].id)),k.push(g[l].id);return e.insert(i,d.selections),f.clearSelections(),a.sortMenuIndex(j.id,k),!0}}a.getView().refresh()}})},sortMenuIndex:function(a,b){MODx.Ajax.request({url:CustomRequest.config.connectorUrl,params:{action:"mgr/configs/sortmenuindex",targetId:a,movingIds:b.join()},listeners:{success:{fn:this.refresh,scope:this}}})},buttonColumnRenderer:function(a,b,c,d,e,f){var g=(c.data,{action_buttons:[{className:"update",icon:"pencil-square-o",text:_("delicart.order_update")},{className:"remove",icon:"trash-o",text:_("delicart.order_remove")}]});return this.buttonColumnTpl.apply(g)},onClick:function(a){var b=a.getTarget(),c=b.className.split(" ")[0];if("icon"==c){var d=b.className.split(" ")[1],e=this.getSelectionModel().getSelected();switch(this.menu.record=e.data,d){case"remove":this.removeConfig(e,a);break;case"update":this.updateConfig(e,a)}}}}),Ext.reg("customrequest-grid-configs",CustomRequest.grid.Configs),CustomRequest.window.CreateUpdateConfig=function(a){a=a||{},this.ident=a.ident||"customrequest-mecitem"+Ext.id(),Ext.applyIf(a,{id:this.ident,url:CustomRequest.config.connectorUrl,action:a.isUpdate?"mgr/configs/update":"mgr/configs/create",autoHeight:!0,fields:[{xtype:"textfield",fieldLabel:_("customrequest.configs_name"),name:"name",id:this.ident+"-name",anchor:"100%"},{xtype:"textfield",fieldLabel:_("customrequest.configs_alias"),description:_("customrequest.configs_alias_desc"),name:"alias",id:this.ident+"-alias",anchor:"100%"},{xtype:"customrequest-combo-resource",fieldLabel:_("customrequest.configs_resourceid"),description:_("customrequest.configs_resourceid_desc"),name:"resourceid",hiddenName:"resourceid",id:this.ident+"-resourceid",anchor:"100%"},{xtype:"textarea",fieldLabel:_("customrequest.configs_urlparams"),description:_("customrequest.configs_urlparams_desc"),name:"urlparams",id:this.ident+"-urlparams",anchor:"100%"},{xtype:"textarea",fieldLabel:_("customrequest.configs_regex"),description:_("customrequest.configs_regex_desc"),name:"regex",id:this.ident+"-regex",anchor:"100%"},{xtype:"textfield",name:"id",id:this.ident+"-id",hidden:!0}],listeners:{render:function(a){Ext.create("Ext.tip.QuickTip",{target:a.getEl()})}}}),CustomRequest.window.CreateUpdateConfig.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.window.CreateUpdateConfig,MODx.Window),Ext.reg("customrequest-window-config-create-update",CustomRequest.window.CreateUpdateConfig),CustomRequest.panel.Home=function(a){a=a||{},Ext.applyIf(a,{cls:"container",defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("customrequest")+"</h2>",cls:"modx-page-header",border:!1},{defaults:{border:!1,autoHeight:!0},border:!0,items:[{xtype:"modx-tabs",deferredRender:!1,forceLayout:!0,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:[{xtype:"customrequest-panel-configs"}]}]}]}),CustomRequest.panel.Home.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.panel.Home,MODx.Panel),Ext.reg("customrequest-panel-home",CustomRequest.panel.Home),CustomRequest.panel.Configs=function(a){a=a||{},Ext.applyIf(a,{id:"customrequest-panel-configs",title:_("customrequest.configs"),items:[{html:"<p>"+_("customrequest.configs_desc")+"</p>",border:!1,bodyCssClass:"panel-desc"},{cls:"main-wrapper",items:[{html:"<p>"+_("customrequest.configs_desc_extended")+"</p>",style:{"margin-bottom":"10px","font-style":"italic"},border:!1},{layout:"form",id:"customrequest-panel-configs-grid",defaults:{border:!1,autoHeight:!0},border:!0,items:[{xtype:"customrequest-grid-configs",preventRender:!0}]}]}]}),CustomRequest.panel.Configs.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.panel.Configs,MODx.Panel),Ext.reg("customrequest-panel-configs",CustomRequest.panel.Configs),CustomRequest.page.Home=function(a){a=a||{},Ext.applyIf(a,{formpanel:"customrequest-panel-home",components:[{xtype:"customrequest-panel-home"}]}),CustomRequest.page.Home.superclass.constructor.call(this,a)},Ext.extend(CustomRequest.page.Home,MODx.Component),Ext.reg("customrequest-page-home",CustomRequest.page.Home);